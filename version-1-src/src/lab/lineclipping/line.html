<!DOCTYPE HTML>
<html>
<head>
  <script type="text/javascript" src="canvasjs.min.js"></script>
  <script type="text/javascript" src="intersectdata.js"></script>
  <script type="text/javascript" src="clipwindow.js"></script>
  <script type="text/javascript" src="experimentlab.js"></script>
  <script type="text/javascript" src="iterator.js"></script>
  <script type="text/javascript">
  </script>
</head>
 
<body>
  <div id="chartContainer" style="height: 500px; width: 50%;"></div>
  <div id="inputinformation">
  <br>
  <p id="text_one">Co-ordinates of bottom left corner</p>             
  <input id="xmin" type="number" value = 100 >    
  <input id="ymin" type="number" value = 100 >
  <br>
  <p id="text_two"> Co-ordinates of upper right  corner</p>
  <input id="xmax" type="number" value = 300 >    
  <input id="ymax" type="number" value = 300 >  
  <br>
  </div>         
  <br>
  <button id="Enter" style="width:150px;">Enter</button>       
  <button id="customexperiment" style="display:none;">Start Experiment</button>
  <button id="previous" style="display:none;">previous</button>    
  <button id="next" style="display:none">next</button>   
  <br>    
  <br>    
  <button id="defaultexperiment" style="width:150px;">Start Experiment with default values</button>
  <button id="back" style="display:none;">back</button>    
  <script>
      var objwindow = null;
      objwindow = new clipwindow();
      objwindow.defaultwindow();
      var lineiterator = null;
      
      function hidefield(fieldid)
      {
       document.getElementById(fieldid).style.display ="none"   
      }
      
      function displayfield(fieldid)
      {
        document.getElementById(fieldid).style.display = "block"
        document.getElementById(fieldid).style.display = "inline-block";
      }
      function startlineiterator(objExperiment)
      {
          if(lineiterator != null)lineiterator = null;
          if(objExperiment.intersections_list.length == 0)
            {
              objwindow.finalclipdps.length = 0;
              objwindow.finalclipdps.push(objwindow.cliplinedps.pop());
            }
          else
            {
              lineiterator = new Iterator(objExperiment.intersections_list.slice());
            }
      }
      
      document.getElementById("defaultexperiment").addEventListener("click", function(){
              start = [10, 350];
              end = [350, 10];
              
              var objExperiment = new experimentLab(objwindow,start.slice(),end.slice());
              objExperiment.startlineExperiment();
              
              hidefield("defaultexperiment");
              hidefield("Enter");
              hidefield("inputinformation");
              displayfield("previous");
              displayfield("next");
              displayfield("back");
              startlineiterator(objExperiment);    
          
              
         });
      
       
      document.getElementById("Enter").addEventListener("click",function(){
           if(objwindow.updatewindow())
               {  
                   hidefield("Enter");
                   hidefield("defaultexperiment");
                   displayfield("customexperiment");
                   displayfield("back");
                  
                   document.getElementById('text_one').innerHTML = "Enter cordinates (x,y) of one end point of line";
                   document.getElementById('text_two').innerHTML = "Enter cordinates (x,y) of other end point of line"; 
                   document.getElementById("xmin").value = 10;
                   document.getElementById("xmax").value = 350;
                   document.getElementById("ymin").value = 350;
                   document.getElementById("ymax").value = 10;
                   
               
               }           
                
        });
        document.getElementById("back").addEventListener("click",function(){
            objwindow.defaultwindow();
            hidefield("customexperiment");
            hidefield("back");
            hidefield("previous");
            hidefield("next");
            
            displayfield("Enter");
            displayfield("defaultexperiment");
            displayfield("inputinformation");
            document.getElementById('text_one').innerHTML = "Co-ordinates of bottom left corner";
            document.getElementById('text_two').innerHTML = "Co-ordinates of upper right corner";
            
        });
      
      document.getElementById("customexperiment").addEventListener("click",function(){
              start = [document.getElementById("xmin").value, document.getElementById("ymin").value];
              end = [document.getElementById("xmax").value, document.getElementById("ymax").value];
              var objExperiment = new experimentLab(objwindow,start,end);
              objExperiment.startlineExperiment();
              
              hidefield("customexperiment");
              hidefield("inputinformation");
              displayfield("previous");
              displayfield("next");
              startlineiterator(objExperiment);    
                            
              
      });
      document.getElementById("previous").addEventListener("click",function(){
          if(lineiterator != null)
          {
            console.log(objwindow.clipdataenddps.length);
            console.log(objwindow.clipdatadps.length);  
            if(objwindow.clipdataenddps.length >= 1)  
            {
                objwindow.clipdataenddps.pop();
                objwindow.clipdataenddps.pop();
             }
            else if(objwindow.clipdatadps.length >= 1)
             {
                objwindow.clipdatadps.pop();
                objwindow.clipdatadps.pop();
             }
             objwindow.chart.render();    
          }
         
      });
      document.getElementById("next").addEventListener("click",function(){
         if(lineiterator != null)
             {
                var data = [];
                var start = [];
                var end = []; 
          
                if(lineiterator.hasNext())
                    {
                      data = lineiterator.next();
                      console.log(data);     
                      start = data.start.slice();
                      end = data.end.slice();  
                                    
                      if(data.pointtype == "start")
                         objwindow.clipdatadps.push({x:parseInt(start[0]),y:parseInt(start[1])},{x:parseInt(end[0]),y:parseInt(end[1])});    
                      else
                         objwindow.clipdataenddps.push({x:parseInt(start[0]),y:parseInt(start[1])},{x:parseInt(end[0]),y:parseInt(end[1])});
                        
                     
                      objwindow.chart.render();       
                    }
                else
                     {
                     
                      objwindow.clipdatadps.length=0;
                      objwindow.clipdataenddps.length = 0;    
                      data = lineiterator.reset();
                      objwindow.finalclipdps.length =0;     
                      objwindow.finalclipdps =objwindow.cliplinedps.slice();
                      objwindow.chart.render();    
                          
                     }
               
              }
             
        });
    </script>
    
</body>
</html>